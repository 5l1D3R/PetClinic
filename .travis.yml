language: python
python: "2.7"
sudo: required

services:
  - docker
cache:
  directories:
  - $HOME/.m2
addons:
  apt:
    packages:
    - python-pip
    - oracle-java8-installer
    - oracle-java8-set-default

install:
  - pip install ansible
  - pip install docker-py
  - pip install boto
  - pip install boto3
  - pip install troposphere
  - printf '[defaults]\nroles_path=../' >ansible.cfg
  - ansible-galaxy install -p ../ fiunchinho.wimpy,feature/build_app_with_compose

script:
  - ./mvnw package
  - echo $VAULT_PASSWORD > /tmp/vault
  - ansible-playbook deploy/deploy.yml -vvvv --vault-password-file=/tmp/vault --extra-vars "wimpy_release_version=${TRAVIS_COMMIT} wimpy_deployment_environment=develop"
env:
  global:
    - secure: "Oszmm0i+3HexfkeRkDMcfVilrXzFAYSdReJ+LoMo8qEXhAHL2UxMLGSU1JMVMKQzShm4rvu2/BB0RyQtc/YgzEOatvpuatTy7ucOlECcZA3/4DEnM0LDSZuadfc0RWVshF0H0w/1spTlN4Z4199BHoeI9/1EbMCjNdz+8UkCONb0RoHaokb/Ev5pgjw6kf/kWuu9yhdbij4tJ14S1A7ptgnHAQ4oMiME2hp/8JRFmZZ37n71mo26O0ChvYNwMmYdlU6kMw5wZMFfTNXVqKjKb9P7Xjw3iW+f4adftAGUNfnPqb4VipMltJptx/pbVujkKDqI0Ir3HYwhefj5mlogmh8u1I3N6/FDH2B35L9TSeihFz0gh5lNcxH0ETnnrCQFbYGDUnS6vLPLBo4/cVD+ijEfrTY6MKGbYerILbYUgykGYyWMikVw6Po0qtMe8trZLv+sdRlCFyjDD0+gmE54kZHG7W8ERs1RoDC0slNI3R+7yooSctfvRxyBwpzcUCTruWv52gmpgpBQhd2kTNsHfM34ntQqrpmWnPHBHp8pwc5j4Bv3rr4n3TU0hD5BnYJF2vPjbjFl0lifmifY1APx6ogQyj0pgBpbQ0GQ8Aov1szC5qgLn2cJmtuUYoc/cHIb2bZtIvxyM7l/mWPQ0/BpiHJCRjK8YdoQsvYZE3h/0Co=" # VAULT_PASSWORD
    - secure: "jxB/XNcDvTT7NqR8ocgQsNK73zbHsaDZDJ6arG+Bx1aO8te1BpketocixdvjUwnjptbN7dBTTB6CqkeJzRCLnwxyhQdJ2OiskRmlyvXZ4twqCYMjEibJo5LPfzZFSbPIsSR10gO1FWyQly7hKRhq2ZSVLMW1uREvdkBz/WV0nKEJ5D3MBDuW9YiDmAzQRTEYJ4D5D4gKbWAVF9Xuueq2T6TxWI94GUYWKFBnrbS5PF7kw+WvEb0cj5C4nC7a9QNsXKxp03xHiGRzmcerZAHyPlxTHnJNdplos25Rno7+nLmLosczM/QZTq4O+6ARxRyQQwvCy225nLNK5nUL3eCtlNbWP7rpUwHT2VsiCBcWcN7c9xphYaWbXL6BlU4M8QMbOOfeOAsoMDfRuBarQCX0DwkJBdOYb+h9pafjmuOCQmVpsfoRG9OxIco80wgloP03cYxFeF8XxpM3KlI4SUbLcFT5+HHCvpWd+xxPRfmbZnIQfls8c3d8Q2TJiT65BbQf/JKSiwtw9PHKk35dGZeB1KJ4G//f+HdQAv5KecqaeoyyLXre7ocb3hHbMbnshdBKs8pE73SWAKuqv6DInQ9cbvAM0M2wc4LIfYdUbTr3NZ9+TbzzRgPPlOxwkcI/vfpxNLN47B8vXVhQrECIBuNO6cAtbvYV18NDVDIpYPnFmpU=" # AWS_ACCESS_KEY_ID
    - secure: "D1DeyOqH22gj0HuW527bXMRv9MCm+WM5Q+slOXElp8XTlqtGiNQ3Ag2ZAP7dAeEa2GsmsYfraJ52nTDJR4usjsunIuzIa5vVLZwwlk3Tg8gW3zlkS73kPIkUL8jFzaWoggz+yZbXeqW0n6FVXjhLZnW5b6UZQ0bNFtlMDUPAJ8w3MvUD9Eb4WrK1TBPPUvGnVUa9qPSgMgvwKD7YSBMxpWlU96z6mTZem7dnGGntmrX2RYqa76R6kZ1AUenFLW7I0oJmoxOCh/5f5a8kXegpBv6wo+z6/Ae71penjim4FfpAgfdZ72jkAftaalvP8k50prQpwiy95YKsuqzXgYCkSRHAfSoH70yxP6bmAIOTDoCv/gwE7M/clMO28I/XDIIKSl4av5tbWifKOdMHuMV5Ipu1JFuVXwD4wHYxettH43AzOLGSTxL7TL3SW2AeRyY1cj5T4MszrQPMcg1SfSjvDlhtq2yS/AeTBrn9cahcXX77xAgezJYH5eYoVXubIDLFqvBb9yYDmBV1e7BvZe02m5ide4BM/WwWsuxt9zclJXG447/V0UKKs9AUWXlyFKZPYlVcT7sHZtFePTyH/pGzGoV3gdq6NhJtLi17rQNMwueVmSyCXdstlMiye76uVszT2itiQwdoPVYKumbYxkt/GyHCfEUnJmQS79+XUaBiug4=" # AWS_SECRET_ACCESS_KEY
