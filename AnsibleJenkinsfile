pipeline {
    agent {label 'slave-debian'}
    
    tools {
      maven 'M3'
      dockerTool 'Docker'
    }

    environment {
		DOCKERHUB_CREDENTIALS=credentials('dockerhub_id')
		DOCKER_TAG = getVersion()
	}

    stages {
        stage('CHECKOUT'){
            steps{
                git branch: 'dev', url: 'https://github.com/ayeliferov/spring.git'
            }
        }

        stage('Docker Deploy'){
			steps {
                ansiblePlaybook(
                    credentialsId: 'dev-server',
//                    vaultCredentialsId: 'AnsibleVault',
                    disableHostKeyChecking: true,
                    extras: '-e DOCKER_TAG=${DOCKER_TAG} DOCKERHUB_CREDENTIALS=${DOCKERHUB_CREDENTIALS}',
                    installation: 'ansible',
                    inventory: 'dev.inv',
                    playbook: 'ansible-playbook.yml'
                )
			}
		}
    }



}